Demonstrations erupted last September following the death in custody of a woman held by Iran's morality police.
Ah.
Anyone they decide they really want to keep they can just claim is a spy, any dual citizen they can keep as leverage over their countries, and they can show all the "I regret what I did, you're right to treat us as garbage and you're actually amazing, Supreme Leader" letters to claim that the regime isn't, y'know, evil.
I would take this with a massive grain of salt.
According to the letter that BBC Persian refers to, which is from Iran's judiciary states, they've said that “crimes against internal and external security and perpetrators of buying, selling and smuggling firearms, people with the crime of robbery and banditry, crimes related to drugs, corruption and prostitution, smuggling of alcoholic beverages, organised smuggling of goods and currency, overseeing and assisting in major and large-scale disruptions in the economic system” won’t be included.
And a lot of protestors have been given charges related to national security.