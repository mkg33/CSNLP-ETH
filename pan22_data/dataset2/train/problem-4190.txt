Either way, mind of course that using HTTP HOST header to select the content served has security implications, like any other user provided input.
Yes, it can be done through .htaccess but it will only work if you have a wildcard DNS entry for the domain or you also add a DNS record for each sub-domain.
In my web app, I'm toying with the idea of giving my user the opportunity to select a subdomain of their choosing, so they could select something like:
i think the mod_rewrite way is more intended to serve different directories, so i'd rather handle it inside the application itself. After all you're talking just about URL rewriting within the same application. A wild card DNS record would still be needed, tho.
where foobar is their chosen subdomain.  What is the proper way to go about setting up something like this?  .htaccess?  Have some api for writing virtual hosts?  The application would still always map to one directory on my sever, I just want to give theme a custom URL.
I would set up an API that writes virtual hosts as you suggest, just make sure it makes the appropriate checks to make sure nothing dodgy happens; such as multiple VH with the same name, naming conventions etc...