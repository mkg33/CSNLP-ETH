I can see the CPU and Memory spike, but what I don't know how to do is quickly identify which site is getting hammered. Usually I find myself running tail -f on each site access log for a few seconds until I find the log that is being written to more often than expected.
I have a couple of clients that run multiple, low traffic websites on a given Ubuntu server. When I set these things up, I always configure each Nginx virtual host to write to its own access|error log file.
I'm wondering whether there's some kind of one-liner script that could help me quickly identify which of these access log files is growing fastest or getting written to the most or whatever. Just anything that gets me closer to identifying the target faster than I'm currently getting there with my laborious approach.
Assuming you keep your log files under /var/log/nginx with names that include access, this can do the trick:
Notice that this is a "more or less" indication, if you're under a Syn flood attack or such you should check other stuff.
That approach works great for almost everything, but the one scenario where it bites me from time to time is when one site is getting hammered by some kind of brute force attack or even weird outlier events that aren't malicious, but generate similarly unnecessary and unwanted traffic.