Hopefully someone knows of a simple solution to this problem. The only limitation I have is that this must run on a CentOS box, but I'm pretty open to any tools and languages.
I'm trying to find a solution that will allow for a user to connect to a server via SFTP using a provided username/key combination (stored in a Wordpress installation's MySQL database), without needing to constantly keep two or more separate systems in sync.
This is the MySQL query that gets two columns that have the username of a user and the api key, which the user would type in to their SFTP client as their password:
You can replace the backends of PAM and the Name Service Switch (NSS) with a MySQL backend. You will need pam-mysql and libnss-mysql.
As far as the file system goes, there is a folder which has the same name as a user's username for each user, all in the same directory. This user's folder may or may not already exist. When a user makes an SFTP connection to the server, they should be shown only the contents of that folder once authenticated.