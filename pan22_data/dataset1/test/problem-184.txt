Is it possible on Linux (Ubuntu in my case) to configure the system to run a bash script just before a USB key is unmounted?
I have a portable personal wiki on a pendrive, and every time I unmount it from my machine I would like its contents to be automatically backed up to Amazon S3.
Is anything like this possible? It doesn't matter if the script runs for every single unmounting as I can easily identify in the script whether the device being unmounted is the one I want to back up.
I don't think there's a generic way of running a script before a device is unmounted.
You could run the backup script after the device is unmounted, but it would be very fiddly â€” you'd have to remount the device, run the backup, unmount the device again (without retriggering your script), and finally arrange to notify the user that the device can be unplugged.
To run a script before the unmount, call your own unmount script instead of /bin/umount. If you want to handle GUIs that call /bin/umount whether you want it or not, you can divert the umount executable and put your script in its place: