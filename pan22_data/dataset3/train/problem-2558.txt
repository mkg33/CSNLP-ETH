This isn't some form of grey-listing test to see how you implement queueing.
Messages usually aren't rejected based on failure of 1 criteria, especially by "the big boys", so I would guess that you're failing multiple tests, but the only way to find out exactly (considering the lack of information in the rejection message) is to ask them unfortunately.
As others have pointed out, 99.9% of 554's are issued because you message failed an anti-spam test.
I couldn't find a similar page for Yahoo at a quick look.
The fact that you get the 554 after the end of DATA suggests that there is something in the content of the message that they don't like, although the server could have already decided that it's going to reject your message much earlier than that and has been configured to wait until the end for various reasons (1. waste your time/bandwidth/resources, and 2. gather as much information about your message as possible).
I found this page for Google in relation to your problem which may be a good path to follow.
The hardest part of these situations is that you're failing policies that are developed and enforced by the receiving end; they might be rejecting your message because the body has the word "apple" in it and the last octet of your IP address is a multiple of 3 for all we know.